<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementation Challenges | GPU-NVMe Documentation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%);
            color: #e0e0e0;
            min-height: 100vh;
            line-height: 1.6;
        }
        #root {
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Navigation Component
        function Navigation() {
            return (
                <nav style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    right: 0,
                    background: 'rgba(10, 10, 15, 0.95)',
                    backdropFilter: 'blur(10px)',
                    borderBottom: '1px solid rgba(255,255,255,0.1)',
                    padding: '1rem 2rem',
                    zIndex: 1000,
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center'
                }}>
                    <a href="index.html" style={{
                        color: '#00ff88',
                        textDecoration: 'none',
                        fontSize: '1.2rem',
                        fontWeight: 'bold'
                    }}>&larr; GPU-NVMe Docs</a>
                    <div style={{ display: 'flex', gap: '1.5rem' }}>
                        <a href="01_motivation.html" style={{ color: '#888', textDecoration: 'none' }}>1. Motivation</a>
                        <a href="02_cpu_vs_gpu.html" style={{ color: '#888', textDecoration: 'none' }}>2. CPU vs GPU</a>
                        <a href="03_sync_problem.html" style={{ color: '#888', textDecoration: 'none' }}>3. Sync Crisis</a>
                        <span style={{ color: '#ff6b6b', fontWeight: 'bold' }}>4. Challenges</span>
                        <a href="05_expert_deep_dive.html" style={{ color: '#00ff88', textDecoration: 'none' }}>5. Expert Deep Dive</a>
                    </div>
                </nav>
            );
        }

        // Challenge Card Component
        function ChallengeCard({ number, title, description, details, color }) {
            const [expanded, setExpanded] = useState(false);
            
            return (
                <div 
                    onClick={() => setExpanded(!expanded)}
                    style={{
                        background: 'rgba(30, 30, 50, 0.6)',
                        border: `2px solid ${expanded ? color : 'rgba(255,255,255,0.1)'}`,
                        borderRadius: '16px',
                        padding: '1.5rem',
                        cursor: 'pointer',
                        transition: 'all 0.3s ease',
                        transform: expanded ? 'scale(1.02)' : 'scale(1)'
                    }}
                >
                    <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '0.5rem' }}>
                        <div style={{
                            width: '40px',
                            height: '40px',
                            borderRadius: '50%',
                            background: color,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontWeight: 'bold',
                            color: '#000',
                            fontSize: '1.2rem'
                        }}>
                            {number}
                        </div>
                        <h3 style={{ color: '#fff', fontSize: '1.2rem' }}>{title}</h3>
                        <span style={{ marginLeft: 'auto', color: '#888' }}>{expanded ? 'dash;¬º' : 'dash;¬∂'}</span>
                    </div>
                    <p style={{ color: '#aaa', marginBottom: expanded ? '1rem' : 0 }}>{description}</p>
                    {expanded && (
                        <div style={{
                            background: 'rgba(0,0,0,0.3)',
                            borderRadius: '8px',
                            padding: '1rem',
                            marginTop: '1rem',
                            borderLeft: `3px solid ${color}`
                        }}>
                            {details.map((detail, i) => (
                                <p key={i} style={{ color: '#ccc', marginBottom: i < details.length - 1 ? '0.5rem' : 0 }}>
                                    &bull; {detail}
                                </p>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // Recommendations Item
        function ActionItem({ number, text, highlight }) {
            const [hovered, setHovered] = useState(false);
            
            return (
                <div 
                    onMouseEnter={() => setHovered(true)}
                    onMouseLeave={() => setHovered(false)}
                    style={{
                        display: 'flex',
                        alignItems: 'flex-start',
                        gap: '1rem',
                        padding: '1rem',
                        background: hovered ? 'rgba(168, 85, 247, 0.1)' : 'transparent',
                        borderRadius: '8px',
                        transition: 'all 0.3s ease',
                        cursor: 'default'
                    }}
                >
                    <div style={{
                        minWidth: '32px',
                        height: '32px',
                        borderRadius: '50%',
                        background: hovered ? '#a855f7' : 'rgba(168, 85, 247, 0.3)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontWeight: 'bold',
                        color: hovered ? '#000' : '#a855f7',
                        transition: 'all 0.3s ease'
                    }}>
                        {number}
                    </div>
                    <p style={{ color: '#e0e0e0', fontSize: '1.1rem' }}>
                        {text}
                        {highlight && (
                            <span style={{ color: '#a855f7', fontWeight: 'bold' }}> {highlight}</span>
                        )}
                    </p>
                </div>
            );
        }

        // Summary Box
        function SummaryBox({ title, icon, items, color }) {
            return (
                <div style={{
                    background: 'rgba(30, 30, 50, 0.6)',
                    border: `1px solid ${color}`,
                    borderRadius: '16px',
                    padding: '1.5rem',
                    flex: 1,
                    minWidth: '280px'
                }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1rem' }}>
                        <span style={{ fontSize: '1.5rem' }}>{icon}</span>
                        <h3 style={{ color: color, fontSize: '1.1rem' }}>{title}</h3>
                    </div>
                    {items.map((item, i) => (
                        <p key={i} style={{ color: '#ccc', marginBottom: '0.5rem', paddingLeft: '0.5rem' }}>
                            &bull; {item}
                        </p>
                    ))}
                </div>
            );
        }

        // Main Component
        function ChallengesPage() {
            const [animationPhase, setAnimationPhase] = useState(0);

            useEffect(() => {
                const timer = setInterval(() => {
                    setAnimationPhase(p => (p + 1) % 4);
                }, 2000);
                return () => clearInterval(timer);
            }, []);

            const challenges = [
                {
                    number: 1,
                    title: "I/O Queue Scaling",
                    description: "NVMe supports up to 65K queues theoretically, but practical limits are 128-1024 SQ/CQ pairs per SSD.",
                    details: [
                        "GPU has I/O-agent warps (not all threads) handle queue submission",
                        "Current SQ/CQ limits force heavy contention and synchronization",
                        "Memory overhead per I/O queue limits practical scalability",
                        "Need improved queue scaling for GPU workloads"
                    ],
                    color: "#ff6b6b"
                },
                {
                    number: 2,
                    title: "Doorbells, MSI-X & Interrupts",
                    description: "Current interrupt and doorbell mechanisms don't scale for GPU architectures.",
                    details: [
                        "GPUs cannot process MSI-X interrupts (no interrupt handlers)",
                        "Doorbell writes create PCIe traffic bottlenecks",
                        "Each doorbell ring requires synchronization across threads",
                        "Future GPUs will have even more threads requiring notification"
                    ],
                    color: "#fbbf24"
                },
                {
                    number: 3,
                    title: "PCIe Lane Optimization",
                    description: "PCIe bandwidth is precious - every byte of protocol overhead matters.",
                    details: [
                        "Command submission uses 64-byte entries",
                        "Completion entries add overhead",
                        "Doorbell writes consume PCIe transactions",
                        "Small I/O amplifies protocol overhead dramatically"
                    ],
                    color: "#00d4ff"
                },
                {
                    number: 4,
                    title: "High-IOPS Small I/O Patterns",
                    description: "GPU inference workloads with small, random reads require deep pipelining.",
                    details: [
                        "Aggregate node IOPS depends on queue depth &times; SSD count",
                        "Batching I/Os reduces per-operation overhead (amortize submission cost)",
                        "Deep queues (QD 64-256) hide device latency through pipelining",
                        "Sub-4KB I/Os remain inefficient&mdash;coalesce or use KV-SSD when possible"
                    ],
                    color: "#00ff88"
                },
                {
                    number: 5,
                    title: "Dual CPU/GPU Support",
                    description: "SSDs must support both CPU and GPU flows while maintaining infrastructure.",
                    details: [
                        "Configuration management from CPU",
                        "Telemetry and monitoring systems",
                        "Error handling and triage",
                        "Firmware updates and maintenance"
                    ],
                    color: "#a855f7"
                }
            ];

            return (
                <div style={{ minHeight: '100vh' }}>
                    <Navigation />
                    
                    {/* Hero Section */}
                    <section style={{
                        paddingTop: '100px',
                        padding: '120px 2rem 4rem',
                        textAlign: 'center',
                        background: 'linear-gradient(180deg, rgba(255,107,107,0.1) 0%, transparent 50%)'
                    }}>
                        <div style={{
                            display: 'inline-block',
                            background: 'rgba(255, 107, 107, 0.2)',
                            border: '1px solid #ff6b6b',
                            borderRadius: '20px',
                            padding: '0.5rem 1rem',
                            marginBottom: '1.5rem',
                            fontSize: '0.9rem',
                            color: '#ff6b6b'
                        }}>
                            Section 4 &bull; Pages 23-24
                        </div>
                        <h1 style={{
                            fontSize: 'clamp(2rem, 5vw, 3.5rem)',
                            fontWeight: 'bold',
                            marginBottom: '1rem',
                            background: 'linear-gradient(135deg, #ff6b6b, #fbbf24)',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent'
                        }}>
                            Implementation Challenges
                        </h1>
                        <p style={{
                            fontSize: '1.3rem',
                            color: '#aaa',
                            maxWidth: '700px',
                            margin: '0 auto'
                        }}>
                            The path forward requires fundamental changes to NVMe protocol design
                        </p>
                    </section>

                    {/* Challenges Section */}
                    <section style={{ padding: '2rem', maxWidth: '1000px', margin: '0 auto' }}>
                        <h2 style={{
                            fontSize: '2rem',
                            color: '#ff6b6b',
                            marginBottom: '2rem',
                            textAlign: 'center'
                        }}>
                            üéØ NVMe Challenges for GPU Access
                        </h2>
                        
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                            {challenges.map((challenge) => (
                                <ChallengeCard key={challenge.number} {...challenge} />
                            ))}
                        </div>
                    </section>

                    {/* Recommendations Section */}
                    <section style={{
                        padding: '4rem 2rem',
                        background: 'linear-gradient(180deg, transparent, rgba(168, 85, 247, 0.1))'
                    }}>
                        <div style={{ maxWidth: '900px', margin: '0 auto' }}>
                            <h2 style={{
                                fontSize: '2rem',
                                color: '#a855f7',
                                marginBottom: '0.5rem',
                                textAlign: 'center'
                            }}>
                                Recommendations
                            </h2>
                            <p style={{
                                color: '#888',
                                textAlign: 'center',
                                marginBottom: '2rem'
                            }}>
                                What needs to change in NVMe protocol
                            </p>

                            <div style={{
                                background: 'rgba(30, 30, 50, 0.6)',
                                borderRadius: '16px',
                                padding: '2rem',
                                border: '1px solid rgba(168, 85, 247, 0.3)'
                            }}>
                                <ActionItem 
                                    number={1}
                                    text="GPU needs are fundamentally changing workloads and"
                                    highlight="NVMe handling"
                                />
                                <ActionItem 
                                    number={2}
                                    text="Queue Arbitration and Doorbells have efficiency impacts when handling extremely small block I/O -"
                                    highlight="switching to polling"
                                />
                                <ActionItem 
                                    number={3}
                                    text="Extremely large usage of queues for parallel access from GPU threads"
                                    highlight="needs examination"
                                />
                                <ActionItem 
                                    number={4}
                                    text="Interconnecting several GPUs to access storage behind NVMe requires"
                                    highlight="deep reevaluation to reduce overheads"
                                />
                            </div>

                            {/* Exciting Times Banner */}
                            <div style={{
                                marginTop: '2rem',
                                padding: '2rem',
                                background: 'linear-gradient(135deg, #ff6b6b, #fbbf24)',
                                borderRadius: '16px',
                                textAlign: 'center'
                            }}>
                                <h3 style={{
                                    fontSize: '2rem',
                                    color: '#000',
                                    fontWeight: 'bold',
                                    textShadow: '0 2px 4px rgba(0,0,0,0.2)'
                                }}>
                                    Exciting times ahead!!!
                                </h3>
                            </div>
                        </div>
                    </section>

                    {/* Summary Section */}
                    <section style={{ padding: '4rem 2rem', maxWidth: '1200px', margin: '0 auto' }}>
                        <h2 style={{
                            fontSize: '2rem',
                            color: '#00ff88',
                            marginBottom: '2rem',
                            textAlign: 'center'
                        }}>
                            Summary
                        </h2>
                        
                        <div style={{ display: 'flex', gap: '1.5rem', flexWrap: 'wrap' }}>
                            <SummaryBox 
                                title="The Problem"
                                icon="¬†"
                                color="#ff6b6b"
                                items={[
                                    "NVMe control plane is CPU-mediated",
                                    "GPU threads funnel through limited I/O agents",
                                    "Synchronization overhead in I/O paths",
                                    "Pipeline staging often not optimized"
                                ]}
                            />
                            <SummaryBox 
                                title="Why It Matters"
                                icon="*"
                                color="#fbbf24"
                                items={[
                                    "AI workloads consume data extremely fast",
                                    "Control-plane latency becomes visible",
                                    "End-to-end pipeline efficiency matters",
                                    "Cost of idle GPU time is massive"
                                ]}
                            />
                            <SummaryBox 
                                title="What Needs to Change"
                                icon="‚Äù¬ß"
                                color="#00ff88"
                                items={[
                                    "Reduce synchronization points",
                                    "Scale I/O queues for GPU thread counts",
                                    "Optimize for polling, not interrupts",
                                    "Protocol evolution for SIMT"
                                ]}
                            />
                        </div>
                    </section>

                    
                    <section style={{
                        padding: '4rem 2rem',
                        background: 'linear-gradient(180deg, transparent, rgba(0, 255, 136, 0.05))',
                        textAlign: 'center'
                    }}>
                        <div style={{ maxWidth: '800px', margin: '0 auto' }}>
                            <div style={{
                                display: 'inline-block',
                                background: 'rgba(0, 255, 136, 0.2)',
                                border: '1px solid #00ff88',
                                borderRadius: '20px',
                                padding: '0.5rem 1rem',
                                marginBottom: '1.5rem',
                                fontSize: '0.9rem',
                                color: '#00ff88'
                            }}>
                                Key Questions
                            </div>
                            <h2 style={{
                                fontSize: '3rem',
                                color: '#00ff88',
                                marginBottom: '1rem'
                            }}>
                                Key Technical Questions
                            </h2>
                            <p style={{ color: '#888', fontSize: '1.2rem', marginBottom: '2rem' }}>
                                Important considerations for GPU-NVMe implementations
                            </p>
                            
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
                                gap: '1rem',
                                textAlign: 'left'
                            }}>
                                <div style={{
                                    background: 'rgba(30, 30, 50, 0.6)',
                                    border: '1px solid rgba(0, 255, 136, 0.3)',
                                    borderRadius: '12px',
                                    padding: '1.5rem'
                                }}>
                                    <span style={{ fontSize: '1.5rem' }}>‚Äù¬ß</span>
                                    <p style={{ color: '#ccc', marginTop: '0.5rem' }}>
                                        How can NVMe protocol better align with GPU SIMT execution model?
                                    </p>
                                </div>
                                <div style={{
                                    background: 'rgba(30, 30, 50, 0.6)',
                                    border: '1px solid rgba(0, 255, 136, 0.3)',
                                    borderRadius: '12px',
                                    padding: '1.5rem'
                                }}>
                                    <span style={{ fontSize: '1.5rem' }}></span>
                                    <p style={{ color: '#ccc', marginTop: '0.5rem' }}>
                                        What I/O queue scaling approaches best serve high-throughput GPU I/O agents?
                                    </p>
                                </div>
                                <div style={{
                                    background: 'rgba(30, 30, 50, 0.6)',
                                    border: '1px solid rgba(0, 255, 136, 0.3)',
                                    borderRadius: '12px',
                                    padding: '1.5rem'
                                }}>
                                    <span style={{ fontSize: '1.5rem' }}></span>
                                    <p style={{ color: '#ccc', marginTop: '0.5rem' }}>
                                        Can doorbell mechanisms be redesigned for polling-first architectures?
                                    </p>
                                </div>
                            </div>
                        </div>
                    </section>

                    
                    <section style={{
                        padding: '3rem 2rem',
                        borderTop: '1px solid rgba(255,255,255,0.1)',
                        textAlign: 'center',
                        background: 'rgba(30, 30, 50, 0.3)'
                    }}>
                        <div style={{
                            display: 'inline-block',
                            background: 'rgba(168, 85, 247, 0.2)',
                            border: '1px solid #a855f7',
                            borderRadius: '20px',
                            padding: '0.5rem 1rem',
                            marginBottom: '1.5rem',
                            fontSize: '0.9rem',
                            color: '#a855f7'
                        }}>
                            Summary
                        </div>
                        
                        <h2 style={{ 
                            fontSize: '2rem', 
                            color: '#fff', 
                            marginBottom: '1rem' 
                        }}>
                            Summary
                        </h2>
                        
                        <p style={{ color: '#888', marginBottom: '2rem' }}>
                            Key Takeaways from GPU-NVMe Architecture
                        </p>
                        
                        <h3 style={{ color: '#fff', marginBottom: '0.5rem', fontSize: '1.3rem' }}>
                            "Why does NVMe need to evolve for efficient storage access from GPUs?"
                        </h3>
                        
                        <div style={{
                            display: 'flex',
                            justifyContent: 'center',
                            gap: '2rem',
                            flexWrap: 'wrap',
                            marginTop: '2rem'
                        }}>
                            <div style={{
                                background: 'rgba(0,0,0,0.3)',
                                borderRadius: '8px',
                                padding: '1rem 1.5rem'
                            }}>
                                <p style={{ color: '#888', fontSize: '0.9rem' }}>Challenge</p>
                                <p style={{ color: '#00ff88', fontWeight: 'bold' }}>CPU Bottleneck</p>
                            </div>
                            <div style={{
                                background: 'rgba(0,0,0,0.3)',
                                borderRadius: '8px',
                                padding: '1rem 1.5rem'
                            }}>
                                <p style={{ color: '#888', fontSize: '0.9rem' }}>Solution</p>
                                <p style={{ color: '#00ff88', fontWeight: 'bold' }}>GPU Direct Storage</p>
                            </div>
                            <div style={{
                                background: 'rgba(0,0,0,0.3)',
                                borderRadius: '8px',
                                padding: '1rem 1.5rem'
                            }}>
                                <p style={{ color: '#888', fontSize: '0.9rem' }}>Future</p>
                                <p style={{ color: '#00ff88', fontWeight: 'bold' }}>NVMe 2.0+ Extensions</p>
                            </div>
                        </div>
                        
                        <p style={{ 
                            color: '#666', 
                            marginTop: '2rem',
                            fontSize: '0.9rem'
                        }}>
                            Continue to the next section for implementation details
                        </p>
                    </section>

                    {/* Navigation Footer */}
                    <footer style={{
                        padding: '2rem',
                        borderTop: '1px solid rgba(255,255,255,0.1)',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center',
                        maxWidth: '1200px',
                        margin: '0 auto'
                    }}>
                        <a href="03_sync_problem.html" style={{
                            color: '#00ff88',
                            textDecoration: 'none',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '0.5rem'
                        }}>
                            &larr; Previous: Sync Crisis
                        </a>
                        <a href="05_expert_deep_dive.html" style={{
                            background: 'linear-gradient(135deg, #00ff88, #00d4ff)',
                            color: '#000',
                            padding: '0.75rem 1.5rem',
                            borderRadius: '8px',
                            textDecoration: 'none',
                            fontWeight: 'bold'
                        }}>
                            Next: Expert Deep Dive &rarr;
                        </a>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<ChallengesPage />, document.getElementById('root'));
    </script>
</body>
</html>
